<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Warfie</title>

  <script src="lib/easeljs-0.8.2.combined.js"></script>
  <script type="text/javascript" src="lib/webcam.js"></script>
  
  <style>
  #mycamera, #camrender, #result, #layer1, #layer2, #layer3, #layer4, #layer5 {
    position: fixed;
  }

  #download {
    margin-left: 900px;
    margin-top: 120px;
    position: absolute;
  }
  </style>


<script id="editable"> //HERE ANIMATION IS DONE!!!
	function initialize() {
    console.log("loaded!");
		// create a new stage and point it at our canvas:
		stage = new createjs.Stage(document.getElementById("layer1"));

		// Define a spritesheet. Note that this data was exported by ZoÃ«.
		var spriteSheet = new createjs.SpriteSheet({
				framerate: 30,
				"images": ["./pics/spritesheet.png"],
    "frames": {"regX": 0, "regY": 0, "height": 292, "count": 64, "width": 165},
				// define two animations, run (loops, 1.5x speed) and jump (returns to run):
				"animations": {
					"run": [0, 25, "run", 1.5],
					"jump": [26, 63, "run"]
				}
			});

		// Events from SpriteSheet (not required for the demo)
		spriteSheet.on("complete", function(event) {
			console.log("Complete", event);
		});
		spriteSheet.on("error", function(event) {
			console.log("Error", event);
		});

		var grant = new createjs.Sprite(spriteSheet, "run");
		grant.x = 0;
		grant.y = 0;

		// Add Grant to the stage, and add it as a listener to Ticker to get updates each frame.
		stage.addChild(grant);
		createjs.Ticker.timingMode = createjs.Ticker.maxDelta;
		createjs.Ticker.addEventListener("tick", stage);
	}

</script>
</head>

<body>
  <canvas id="result" width="480" height="480"></canvas>
  <canvas id="camrender" width="640" height="640" style="background-color:#0000FF"></canvas>
  <div id="mycamera"></div>
  <canvas id="layer1" width="480" height="480"></canvas>
  <canvas id="layer2" width="480" height="480"></canvas>
  <canvas id="layer3" width="480" height="480"></canvas>
  <canvas id="layer4" width="480" height="480"></canvas>
  <canvas id="layer5" width="480" height="480"></canvas>
  <a id="download" href="">Download</a>

  
  <script>
    window.onload = function() {
      var stage;
      initialize();
    };

    Webcam.set({
			// live preview size
			width: 640,
			height: 480,
			
			// device capture size
			dest_width: 640,
		  dest_height: 480,
			
			// final cropped size
			crop_width: 480,
			crop_height: 480,
			
			// format and quality
			image_format: 'jpeg',
			jpeg_quality: 2
		});
		
		Webcam.attach( '#mycamera' );


	  function downloadCanvas(link, canvasId, filename) {
      link.href = document.getElementById(canvasId).toDataURL();
      link.download = filename;
      }
    document.getElementById('download').addEventListener('click', function() {
      var context = result.getContext('2d');
      Webcam.snap( function() {}, camrender );
      context.drawImage(camrender, 0, 0);
      context.drawImage(layer1, 0, 0);
      context.drawImage(layer2, 0, 0);
      context.drawImage(layer3, 0, 0);
      context.drawImage(layer4, 0, 0);
      context.drawImage(layer5, 0, 0);
      downloadCanvas(this, 'result', 'test.png');
      }, false);
  </script>

</body>
</html>